<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>VENITE A MIS 34 üéâ</title>
    
    <!-- Carga de Tailwind CSS --><script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define la fuente Inter y el estilo general */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s;
        }
        /* Resetear m√°rgenes y paddings globales */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            margin: 0 !important;
            padding: 0 !important;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }
        
        /* Prevenir scroll autom√°tico al cargar la p√°gina */
        html:not(:has(:target)) {
            scroll-padding-top: 0;
        }
        
        /* Permitir scroll suave solo para enlaces */
        :target {
            scroll-margin-top: 0;
        }
        
        body {
            margin: 0 !important;
            padding: 0 !important;
            width: 100%;
            min-height: 100%;
            overflow-x: hidden;
            position: relative;
        }
        
        /* Estilos personalizados para el hero con imagen de fondo - SOLO M√ìVILES */
        .hero-background {
            background-image: url('Fondo Celulares.png');
            background-size: cover;
            background-position: center center;
            background-repeat: no-repeat;
            background-color: #000;
            position: relative;
            width: 100%;
            min-height: 100vh;
            height: 100vh;
            margin: 0 !important;
            padding: 0 !important;
        }
        /* Overlay oscuro para mejorar la legibilidad del texto sobre la imagen */
        .hero-background::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.45); /* Capa oscura semi-transparente */
            z-index: -1;
        }
        
        .hero-background > div {
            padding: 40px 20px !important;
            max-width: 100% !important;
            position: relative;
            z-index: 1;
            margin: 0 !important;
            width: 100%;
        }
        
        section.hero-background {
            padding-top: 0 !important;
            padding-bottom: 0 !important;
        }

        /* Color de acento dorado/champagne */
        .accent-color {
            color: #FFD700; /* Oro */
        }
        .bg-accent-color {
            background-color: #FFD700;
        }
        .bg-accent-color:hover {
            background-color: #E6C200; 
        }
        /* Estilo para el overlay de formulario deshabilitado */
        .form-disabled-overlay {
            background-color: rgba(220, 220, 220, 0.85); /* Gris claro semi-transparente */
            backdrop-filter: blur(2px);
            z-index: 10;
        }
        /* Animaci√≥n sutil de los n√∫meros del contador */
        .countdown-number {
            transition: all 0.3s ease-in-out;
        }
        /* Estilo para el modal de "Chusma" */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50; /* Alto z-index para estar sobre todo */
        }

        /* Animaci√≥n de flecha para indicar scroll */
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .scroll-indicator {
            animation: bounce 2s infinite;
            font-size: 2rem;
            opacity: 0.8;
            margin-top: 2rem;
        }
        
        /* Padding para desktop */
        @media (min-width: 769px) {
            .hero-background {
                padding-top: 4rem !important;
                padding-bottom: 4rem !important;
            }
        }
        
        /* Estilos para mobile y tablet/desktop */
        @media (min-width: 1024px) {
            .desktop-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

    </style>
</head>
<body class="antialiased text-gray-800" style="background-color: #000;">

    <!-- HERO PRINCIPAL (CON IMAGEN DE FONDO) --><section class="hero-background text-white px-4 text-center shadow-2xl">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-5xl md:text-7xl font-black mb-4 leading-tight tracking-tight accent-color">
                VENITE A MIS 34 üî•
            </h1>
            <!-- Subt√≠tulo removido a petici√≥n del usuario --><!-- Bloque de Informaci√≥n del Evento --><div class="bg-gray-800 bg-opacity-80 text-white p-6 md:p-8 rounded-2xl shadow-xl inline-block text-left max-w-sm md:max-w-md mx-auto border border-yellow-700/50 mt-8">
                <p class="text-lg md:text-xl font-semibold mb-3">
                    üóìÔ∏è <span class="accent-color">Fecha:</span> JUEVES 20 DE NOVIEMBRE 19:30 HS.
                </p>
                <p class="text-lg md:text-xl font-semibold mb-3">
                    üìç <span class="accent-color">Lugar:</span> PEDRO MORAN 2424, CABA
                </p>
                <p class="text-lg md:text-xl font-semibold">
                    üëó <span class="accent-color">Dress code:</span> LO QUE TE PINTE.
                </p>
            </div>

            <div class="flex flex-col sm:flex-row gap-4 justify-center mt-10">
                <a href="#rsvpSection" class="inline-block bg-accent-color text-gray-900 font-bold py-3 px-8 rounded-full text-lg shadow-xl hover:shadow-2xl hover:scale-[1.02] transition duration-300 ease-in-out transform">
                    Confirmar asistencia ahora
                </a>
                <a href="https://calendar.google.com/calendar/render?action=TEMPLATE&text=VENITE+A+MIS+34&dates=20251120T223000Z/20251121T030000Z&details=Cumplea%C3%B1os+de+34+a%C3%B1os&location=PEDRO+MORAN+2424,+CABA" target="_blank" class="inline-block bg-blue-600 text-white font-bold py-3 px-8 rounded-full text-lg shadow-xl hover:shadow-2xl hover:scale-[1.02] transition duration-300 ease-in-out transform">
                    üìÖ Agendar en Calendar
                </a>
            </div>
            
            <!-- Indicador de scroll -->
            <div class="scroll-indicator text-white">
                ‚¨áÔ∏è
            </div>
        </div>
    </section>

    <!-- CONTADOR REGRESIVO --><section class="py-12 px-4 bg-white shadow-inner">
        <div class="max-w-xl mx-auto text-center bg-gray-50 p-6 rounded-2xl shadow-lg border border-gray-200">
            <p id="deadlineMessage" class="text-lg md:text-xl mb-6 font-semibold text-gray-700">
                Ten√©s tiempo de confirmar hasta: <span class="accent-color font-black">S√ÅBADO 1 DE NOVIEMBRE DEL 2025</span>
            </p>
            <div id="countdown" class="flex justify-center items-center space-x-3 md:space-x-6 text-gray-900">
                <!-- Los n√∫meros se llenan con JS --></div>
            <p class="text-sm text-gray-500 mt-4">
                Despu√©s cierro el n√∫mero final con el catering üôè
            </p>
        </div>
    </section>

    <!-- FORMULARIO DE CONFIRMACI√ìN --><section id="rsvpSection" class="py-16 px-4 bg-gray-100">
        <div class="max-w-3xl mx-auto bg-white p-8 rounded-2xl shadow-2xl relative overflow-hidden">
            <h2 class="text-3xl font-bold text-center mb-8 text-gray-900">Confirmame tu lugar üìù</h2>

            <form id="rsvpForm" class="space-y-6">
                <div>
                    <label for="fullName" class="block text-sm font-medium text-gray-700 mb-2">Nombre y Apellido *</label>
                    <input type="text" id="fullName" name="fullName" required
                           class="w-full p-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-yellow-200 focus:border-accent-color transition duration-200 shadow-sm">
                </div>

                <div>
                    <label for="attendance" class="block text-sm font-medium text-gray-700 mb-2">¬øVen√≠s? *</label>
                    <select id="attendance" name="attendance" required
                            class="w-full p-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-yellow-200 focus:border-accent-color transition duration-200 bg-white shadow-sm">
                        <option value="">-- Seleccion√° una opci√≥n --</option>
                        <option value="si">S√≠ voy</option>
                        <option value="no">No puedo que pena</option>
                    </select>
                </div>

                <!-- Nuevo selector de comida vegetariana --><div>
                    <label for="vegetarian" class="block text-sm font-medium text-gray-700 mb-2">Opci√≥n Vegetariana ü•¨</label>
                    <select id="vegetarian" name="vegetarian"
                            class="w-full p-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-yellow-200 focus:border-accent-color transition duration-200 bg-white shadow-sm">
                        <option value="no" selected>No, gracias (Opci√≥n por defecto)</option>
                        <option value="si">S√≠, prefiero comida vegetariana</option>
                    </select>
                </div>

                <div>
                    <label for="message" class="block text-sm font-medium text-gray-700 mb-2">Mensaje opcional</label>
                    <textarea id="message" name="message" rows="3"
                              class="w-full p-3 border border-gray-300 rounded-xl focus:ring-4 focus:ring-yellow-200 focus:border-accent-color transition duration-200 shadow-sm"
                              placeholder="Ac√° escrib√≠ lo que quieras"></textarea>
                </div>

                <button type="submit"
                        class="w-full bg-accent-color text-gray-900 font-bold py-3 px-6 rounded-full text-lg shadow-md hover:shadow-xl transition duration-300 ease-in-out transform hover:scale-[1.01] disabled:opacity-50 disabled:cursor-not-allowed">
                    ENVIAR CONFIRMACI√ìN
                </button>
            </form>

            <!-- Mensaje de confirmaci√≥n exitosa --><div id="rsvpThanksMessage" class="hidden text-center mt-6 p-6 bg-green-50 rounded-xl border border-green-300">
                <p class="text-2xl font-bold text-green-700">¬°Listo! Gracias por confirmar ‚ù§Ô∏è</p>
                <p class="text-green-600 mt-2">¬°Te veo pronto!</p>
            </div>

            <!-- OVERLAY DE FORMULARIO DESHABILITADO --><div id="formDisabledOverlay" class="absolute inset-0 flex items-center justify-center p-8 rounded-2xl hidden form-disabled-overlay">
                <div class="text-center text-gray-900 p-8 bg-white rounded-2xl shadow-2xl border-2 border-red-400 transform scale-105">
                    <p class="text-2xl font-black mb-3 text-red-600">Cierre de confirmaciones ‚õî</p>
                    <p class="text-lg font-medium">
                        Ya pas√© el n√∫mero final al catering.
                    </p>
                    <p class="text-base mt-2">
                        Si necesit√°s hablarme urgente, por favor, escribime por WhatsApp. ¬°Gracias!
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- BLOQUE FINAL INFO PR√ÅCTICA --><section class="py-12 px-4 bg-gray-50">
        <div class="max-w-3xl mx-auto bg-white p-8 rounded-2xl shadow-lg border-t-4 border-accent-color">
            <h2 class="text-3xl font-bold text-center mb-8 text-gray-900">Detalles clave üí°</h2>

            <div class="space-y-8">
                <!-- Ubicaci√≥n y c√≥mo llegar modificado --><div>
                    <h3 class="text-xl font-black accent-color mb-2">Ubicaci√≥n y c√≥mo llegar üìç</h3>
                    <p class="text-gray-700 mb-4">
                        El lugar queda en PEDRO MORAN 2424, CABA.
                    </p>
                    <!-- Bot√≥n de c√≥mo llegar --><a href="https://maps.google.com/?q=PEDRO+MORAN+2424,+CABA" target="_blank" class="inline-block bg-gray-800 text-white font-bold py-2 px-4 rounded-full text-sm shadow-md hover:bg-gray-700 transition duration-200">
                        Abrir en Google Maps üó∫Ô∏è
                    </a>
                </div>

                <!-- Nota sobre regalos modificado --><div>
                    <h3 class="text-xl font-black accent-color mb-2">Nota sobre regalos üéÅ</h3>
                    <p class="text-gray-700">
                        No hace falta que traigas nada, tu presencia es la mejor. Ahora, si insist√≠s con regalar, te dejo el CBU de la caja de ahorro en USD que me van a venir bien para un viajecito al caribe o europa.
                        <br class="my-2">
                        <span class="font-bold text-gray-900 break-words">CBU: 93280948928409</span> (Ahre que lo dejaba üòâ)
                    </p>
                </div>

                <!-- Frase de cierre y bot√≥n de chusma --><div class="text-center pt-6 border-t border-gray-200">
                    <p class="text-xl font-black text-gray-800 mb-6">
                        ¬°Te espero! üéâ
                    </p>
                    <button id="showGuestsButton" class="bg-blue-500 text-white font-bold py-4 px-10 rounded-full text-lg shadow-xl hover:bg-blue-600 transition duration-300 ease-in-out transform hover:scale-[1.03]">
                        Ver Invitados üëÄ
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- MODAL (Overlay) de "CHUSMA" --><div id="chusmaModal" class="modal-overlay hidden">
        <div class="bg-white p-8 rounded-xl shadow-2xl text-center max-w-sm w-11/12 border-4 border-accent-color transform scale-105">
            <p class="text-3xl font-black text-gray-900 mb-4">
                JAJAJ que te importaaa quien vieene!
            </p>
            <button id="closeModalButton" class="bg-accent-color text-gray-900 font-bold py-2 px-6 rounded-full mt-4 hover:bg-yellow-400 transition duration-200">
                Cerrar
            </button>
        </div>
    </div>

    <!-- L√ìGICA JAVASCRIPT VANILLA Y FIREBASE --><script type="module">
        // Importar las funciones de Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        // Configuraci√≥n y variables globales del entorno Canvas
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;
        let isAuthReady = false;

        document.addEventListener('DOMContentLoaded', async () => {
            const countdownElement = document.getElementById('countdown');
            const rsvpForm = document.getElementById('rsvpForm');
            const formDisabledOverlay = document.getElementById('formDisabledOverlay');
            const rsvpThanksMessage = document.getElementById('rsvpThanksMessage');
            const showGuestsButton = document.getElementById('showGuestsButton');
            const chusmaModal = document.getElementById('chusmaModal');
            const closeModalButton = document.getElementById('closeModalButton');

            // Forzar scroll al inicio de la p√°gina
            window.scrollTo(0, 0);

            // --- CONFIGURACI√ìN CLAVE (¬°EDITAR!) ---
            const confirmationDeadline = new Date("2025-11-01T23:59:00"); 
            // --- FIN DE CONFIGURACI√ìN ---

            // 1. Inicializar Firebase
            if (firebaseConfig) {
                try {
                    const app = initializeApp(firebaseConfig);
                    db = getFirestore(app);
                    auth = getAuth(app);
                    setLogLevel('debug'); 
                    
                    // 2. Autenticaci√≥n
                    if (initialAuthToken) {
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Firebase: Autenticaci√≥n exitosa con token personalizado.");
                    } else {
                        await signInAnonymously(auth);
                        console.log("Firebase: Autenticaci√≥n an√≥nima exitosa.");
                    }
                    isAuthReady = true;

                } catch (error) {
                    console.error("Firebase Error: No se pudo conectar a la base de datos.", error);
                    // Si falla Firebase, deshabilitar el formulario para evitar intentos fallidos de guardado.
                    disableForm(); 
                }
            } else {
                console.error("Firebase config no disponible. El formulario NO guardar√° datos de forma persistente.");
                isAuthReady = false;
            }

            // --- Funciones de L√≥gica de UI (Contador y Formulario) ---
            function formatTime(value) {
                return String(value).padStart(2, '0');
            }

            function updateCountdown() {
                const now = new Date().getTime();
                const distance = confirmationDeadline - now;

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                if (distance < 0) {
                    clearInterval(countdownInterval);
                    countdownElement.innerHTML = `<span class="text-2xl font-black text-red-600">¬°EL TIEMPO EXPIR√ì!</span>`;
                    disableForm();
                } else {
                    countdownElement.innerHTML = `
                        <!-- Bloques del contador --><div class="flex flex-col items-center">
                            <span class="countdown-number text-5xl md:text-6xl font-extrabold text-gray-900">${formatTime(days)}</span>
                            <span class="text-sm uppercase font-semibold text-gray-600 mt-1">D√≠as</span>
                        </div>
                        <span class="text-4xl md:text-5xl font-extrabold accent-color">:</span>
                        <div class="flex flex-col items-center">
                            <span class="countdown-number text-5xl md:text-6xl font-extrabold text-gray-900">${formatTime(hours)}</span>
                            <span class="text-sm uppercase font-semibold text-gray-600 mt-1">Horas</span>
                        </div>
                        <span class="text-4xl md:text-5xl font-extrabold accent-color">:</span>
                        <div class="flex flex-col items-center">
                            <span class="countdown-number text-5xl md:text-6xl font-extrabold text-gray-900">${formatTime(minutes)}</span>
                            <span class="text-sm uppercase font-semibold text-gray-600 mt-1">Minutos</span>
                        </div>
                        <span class="text-4xl md:text-5xl font-extrabold accent-color">:</span>
                        <div class="flex flex-col items-center">
                            <span class="countdown-number text-5xl md:text-6xl font-extrabold text-gray-900">${formatTime(seconds)}</span>
                            <span class="text-sm uppercase font-semibold text-gray-600 mt-1">Segundos</span>
                        </div>
                    `;
                }
            }

            function disableForm() {
                rsvpForm.querySelectorAll('input, select, textarea, button').forEach(element => {
                    element.setAttribute('disabled', 'true');
                    element.classList.add('opacity-40', 'cursor-not-allowed');
                });
                formDisabledOverlay.classList.remove('hidden');
            }

            // Iniciar y verificar el estado
            updateCountdown();
            const countdownInterval = setInterval(updateCountdown, 1000);

            // Listener para el env√≠o del formulario
            rsvpForm.addEventListener('submit', async function(event) {
                event.preventDefault(); 

                const fullName = document.getElementById('fullName').value;
                const attendance = document.getElementById('attendance').value;
                const vegetarian = document.getElementById('vegetarian').value;
                const message = document.getElementById('message').value;

                if (!fullName || !attendance || attendance === '') {
                    console.error('Faltan campos obligatorios.'); 
                    // Se podr√≠a agregar un mensaje visible de error aqu√≠.
                    return;
                }

                // 3. L√≥gica de guardado en Firestore
                if (isAuthReady) {
                    try {
                        const userId = auth.currentUser ? auth.currentUser.uid : 'anonymous';
                        const docRef = await addDoc(collection(db, `artifacts/${appId}/users/${userId}/rsvps`), {
                            nombre: fullName,
                            asistencia: attendance,
                            vegetariano: vegetarian,
                            mensaje_opcional: message,
                            fechaConfirmacion: serverTimestamp() 
                        });
                        console.log("RSVP guardado en Firestore con ID:", docRef.id);
                    } catch (e) {
                        console.error("Error guardando RSVP en Firestore: ", e);
                        // Mostrar mensaje de error al usuario si el guardado falla
                    }
                } else {
                    // Si Firebase no est√° listo, solo hacemos console.log como fallback.
                    console.log('--- FALLBACK: DATOS NO GUARDADOS PERSISTENTEMENTE (Firebase no listo) ---');
                    console.log({ nombre: fullName, asistencia: attendance, vegetariano: vegetarian, mensaje_opcional: message });
                }

                // 4. Guardar en Google Sheets usando una imagen (m√©todo m√°s simple)
                try {
                    const GOOGLE_APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyB_nKwOb4pR0ccgrOeZxzyJOjCUKdHdZSoxDgO6_Ju8Dzbn0tOjFt2MlzCErAAPEYL/exec';
                    
                    // Enviar datos usando GET
                    const datos = {
                        nombre: fullName,
                        asistencia: attendance,
                        vegetariano: vegetarian,
                        mensaje: message || '',
                        fecha: new Date().toLocaleString('es-AR')
                    };
                    
                    // Construir URL con par√°metros
                    const params = new URLSearchParams(datos);
                    const urlCompleta = GOOGLE_APPS_SCRIPT_URL + '?' + params.toString();
                    
                    // Crear una imagen invisible para hacer la petici√≥n GET
                    const img = new Image();
                    img.style.display = 'none';
                    img.onload = function() {
                        console.log('Datos enviados a Google Sheets exitosamente');
                        document.body.removeChild(img);
                    };
                    img.onerror = function() {
                        console.error('Error al enviar datos a Google Sheets');
                        document.body.removeChild(img);
                    };
                    img.src = urlCompleta;
                    document.body.appendChild(img);
                    
                    console.log('Intentando enviar datos a Google Sheets:', datos);
                } catch (error) {
                    console.error('Error enviando datos a Google Sheets:', error);
                }

                // Mostrar mensaje de √©xito (independientemente de si el guardado persistente fall√≥ o no)
                rsvpForm.classList.add('hidden');
                rsvpThanksMessage.classList.remove('hidden');
            });

            // L√≥gica del bot√≥n de "Ver Invitados" (Chusma)
            showGuestsButton.addEventListener('click', () => {
                chusmaModal.classList.remove('hidden');
            });

            // L√≥gica para cerrar el modal
            closeModalButton.addEventListener('click', () => {
                chusmaModal.classList.add('hidden');
            });

            // Cerrar el modal al hacer click fuera
            chusmaModal.addEventListener('click', (e) => {
                if (e.target === chusmaModal) {
                    chusmaModal.classList.add('hidden');
                }
            });

        });
    </script>
</body>
</html>
